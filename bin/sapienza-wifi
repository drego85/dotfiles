#!/usr/bin/env bash

# This script logins automatically to the Sapienza's Wifi network, without open
# a browser and insert manually the username and password.
# It required Wget to do the request (POST) and pass to get the password.

# TODO:
#   - Add error handling;
#   - Check if the login is succesfully done.

# Copyright (c) 2018 Emanuele Petriglia <inbox@emanuelepetriglia.me>
# All right reserved. This file is licensed under the MIT license.

# Login URL.
URL="https://wifi-cont1.uniroma1.it:8003/index.php?zone=wifi_sapienza"

# Location of the password in the password store database.
PASSWORD_LOCATION="university/uniroma1.it"

# Login details.
USERNAME="1798177"
PASSWORD="$(pass $PASSWORD_LOCATION | head -n 1)"

# POST parameters.
AUTH_USER="auth_user=$USERNAME"
AUTH_PASS="auth_pass=$PASSWORD"
REDIRURL="redirurl=wifi_sapienza"
ACCEPT="accept=Accetto+-+Accept"

DATA="$AUTH_USER&$AUTH_PASS&$REDIRURL&$ACCEPT"

WGET_OPTIONS="--quiet"

wget $WGET_OPTIONS --post-data "$DATA" $URL
